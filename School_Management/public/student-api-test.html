<!DOCTYPE html>
<html>
<head>
    <title>API Test - Student Portal</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #5568d3; }
        pre { background: white; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .logout-btn { background: #dc3545; }
        .logout-btn:hover { background: #c82333; }
    </style>
</head>
<body>
    <h1>Student Portal API Test</h1>
    
    <div class="test-section">
        <h2>1. Login Test</h2>
        <p>Student ID: STU0001, Password: 04012018</p>
        <button onclick="testLogin()">Test Login</button>
        <div id="login-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Dashboard Test</h2>
        <p>Get student dashboard data (must login first)</p>
        <button onclick="testDashboard()">Test Dashboard</button>
        <div id="dashboard-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Logout Test</h2>
        <p>Test logout functionality</p>
        <button class="logout-btn" onclick="testLogout()">Test Logout</button>
        <div id="logout-result"></div>
    </div>

    <script>
        async function testLogin() {
            const resultDiv = document.getElementById('login-result');
            resultDiv.innerHTML = '<p>Testing login...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/student/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        studentId: 'STU0001',
                        password: '04012018'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'test-section success';
                    resultDiv.innerHTML = '<h3>✅ Login Success!</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    resultDiv.className = 'test-section error';
                    resultDiv.innerHTML = '<h3>❌ Login Failed</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                resultDiv.className = 'test-section error';
                resultDiv.innerHTML = '<h3>❌ Error</h3><p>' + error.message + '</p>';
            }
        }

        async function testDashboard() {
            const resultDiv = document.getElementById('dashboard-result');
            resultDiv.innerHTML = '<p>Fetching dashboard...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/student/dashboard', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'test-section success';
                    resultDiv.innerHTML = '<h3>✅ Dashboard Success!</h3>' +
                        '<p><strong>Student:</strong> ' + data.student.firstName + ' ' + data.student.lastName + '</p>' +
                        '<p><strong>Attendance:</strong> ' + data.attendancePercentage + '%</p>' +
                        '<p><strong>Present/Total:</strong> ' + data.attendanceStats.present + '/' + data.attendanceStats.total + '</p>' +
                        '<p><strong>Recent Marks:</strong> ' + data.recentMarks.length + '</p>' +
                        '<p><strong>Subjects:</strong> ' + data.subjects.length + '</p>' +
                        '<details><summary>Full Response</summary><pre>' + JSON.stringify(data, null, 2) + '</pre></details>';
                } else {
                    resultDiv.className = 'test-section error';
                    resultDiv.innerHTML = '<h3>❌ Dashboard Failed</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                resultDiv.className = 'test-section error';
                resultDiv.innerHTML = '<h3>❌ Error</h3><p>' + error.message + '</p>';
            }
        }

        async function testLogout() {
            const resultDiv = document.getElementById('logout-result');
            resultDiv.innerHTML = '<p>Logging out...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/student/logout', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'test-section success';
                    resultDiv.innerHTML = '<h3>✅ Logout Success!</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    resultDiv.className = 'test-section error';
                    resultDiv.innerHTML = '<h3>❌ Logout Failed</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                resultDiv.className = 'test-section error';
                resultDiv.innerHTML = '<h3>❌ Error</h3><p>' + error.message + '</p>';
            }
        }
    </script>
</body>
</html>
